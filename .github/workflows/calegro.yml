name: Multi-Agent Workflow

on:
  workflow_dispatch:
  push:
    branches:
      - scripter-incubator

jobs:
  go_job:
    runs-on: [macOS, calegro]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.22'
      - name: Print current directory ðŸ‘ˆ
        run: ls scripter/working-pocs
      - name: Run Go build and test
        run: |
          cd scripter/working-pocs
          pwd # Optional: Prints the new current directory for confirmation
          go build .

  docker_job:
    runs-on: [ubuntu-latest]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Build and tag Docker image
        run: |
          cd scripter/working-pocs
          docker build -t suck-it .

  redis_job:
    runs-on: [linux, arm64, calegro]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        
      - name: Check for local Redis and Ping
        run: |
          # The runner must have Redis and redis-cli already installed and running.
          echo "Checking for a Redis service on port 6379."
          redis-cli -h 127.0.0.1 -p 6379 ping        
          
  rabbitmq_job:
    runs-on: [linux, X64, calegro]
    services:
      rabbitmq:
        image: rabbitmq:3-management
        ports:
          - 5672:5672
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Run tests with RabbitMQ
        run: |
          echo "Running tests against RabbitMQ on Ubuntu"
          
  dosbox_job:
    runs-on: [Windows, calegro]
    container:
      image: schneidexe/docker-dosbox:latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Run a DOS command
        run: |
          echo "Executing a DOS command in the container."
