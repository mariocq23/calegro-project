name: Multi-Agent Workflow

on:
  push:
    branches:
      - scripter-incubator

jobs:
  go_job:
    runs-on: [macOS, calegro]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.22'
      - name: Print current directory ðŸ‘ˆ
        run: ls scripter/working-pocs
      - name: Run Go build and test
        run: |
          cd scripter/working-pocs
          pwd # Optional: Prints the new current directory for confirmation
          go build .

  docker_job:
    runs-on: [ubuntu-latest]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Build and tag Docker image
        run: |
          cd scripter/working-pocs
          docker build -t suck-it .

  redis_job:
    runs-on: [linux, arm64, calegro]
    services:
      redis:
        image: redis:6
        ports:
          - 6379:6379
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Run tests with Redis
        run: |
          echo "Running tests against Redis on macOS"


      - name: Install redis-cli
        run: sudo apt-get update && sudo apt-get install -y redis-tools

      - name: Wait for Redis and Ping
        run: |
          # Wait for the Redis service to be ready on port 6379
          until nc -z localhost 6379; do
            echo "Waiting for Redis service to be ready..."
            sleep 1
          done
          
          # Ping the Redis server using redis-cli.
          # The service container is accessible on localhost from the job runner.
          redis-cli ping          
          
  rabbitmq_job:
    runs-on: [linux, X64, calegro]
    services:
      rabbitmq:
        image: rabbitmq:3-management
        ports:
          - 5672:5672
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Run tests with RabbitMQ
        run: |
          echo "Running tests against RabbitMQ on Ubuntu"
          
  dosbox_job:
    runs-on: [Windows, calegro]
    container:
      image: schneidexe/docker-dosbox:latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      - name: Run a DOS command
        run: |
          echo "Executing a DOS command in the container."
